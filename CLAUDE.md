# VibeReview API Server

Fastify ê¸°ë°˜ íŒŒì¼ ì—…ë¡œë“œ ë° ë©”íƒ€ë°ì´í„° API ì„œë²„

## í”„ë¡œì íŠ¸ ê°œìš”

ë°”ì´ë¸Œë¦¬ë·° APIëŠ” AI ì½”ë”© ë„êµ¬ì˜ ì„¸ì…˜ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ë©”íƒ€ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” REST API ì„œë²„ì…ë‹ˆë‹¤. Fastifyì™€ Supabaseë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ë˜ì—ˆìœ¼ë©°, Bronze Layer(ì›ë³¸ íŒŒì¼ ì €ì¥)ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.

## í˜„ì¬ êµ¬í˜„ ìƒíƒœ

### âœ… ì™„ë£Œëœ ê¸°ëŠ¥
- [x] Fastify + TypeScript ê¸°ë³¸ ì„¤ì •
- [x] Supabase í´ë¼ì´ì–¸íŠ¸ ì—°ë™
- [x] JWT ê¸°ë°˜ ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
- [x] íŒŒì¼ ì—…ë¡œë“œ API (`/api/upload/`)
  - [x] ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ (ì¤‘ë³µ íŒŒì¼ upsert ì§€ì›)
  - [x] ë°°ì¹˜ íŒŒì¼ ì—…ë¡œë“œ
  - [x] ì—…ë¡œë“œ ìƒíƒœ í™•ì¸
- [x] ë©”íƒ€ë°ì´í„° API (`/api/metadata/`)
  - [x] íŒŒì¼ ëª©ë¡ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜, í•„í„°ë§)
  - [x] íŒŒì¼ ìƒì„¸ ì •ë³´
  - [x] íŒŒì¼ ì‚­ì œ
  - [x] íŒ€ í†µê³„
  - [x] íŒŒì¼ ë‹¤ìš´ë¡œë“œ
- [x] íŒŒì¼ ê²€ì¦ ë° ë³´ì•ˆ
  - [x] MIME íƒ€ì… ê²€ì¦
  - [x] íŒŒì¼ í¬ê¸° ì œí•œ
  - [x] ì•…ì„± ì½˜í…ì¸  ìŠ¤ìº”
  - [x] íŒŒì¼ í•´ì‹œ ê¸°ë°˜ ì¤‘ë³µ ì œê±°
- [x] ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…
- [x] CORS, í—¬ë©§, ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…

## ë‚¨ì€ ì‘ì—… (To-Do List)

### ğŸ”§ ê°œë°œ í™˜ê²½ ë° ì„¤ì •

#### 1. Supabase ì„¤ì • (Dashboard ë°©ì‹)
- [ ] Supabase í”„ë¡œì íŠ¸ ìƒì„± ë° ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (URL, Keys)
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„± (í…Œì´ë¸”, RLS ì •ì±…)
- [ ] Storage ë²„í‚· ìƒì„± ë° ê¶Œí•œ ì„¤ì •
- [ ] ì‹¤ì œ íƒ€ì… ìƒì„± í›„ `database.ts` ì—…ë°ì´íŠ¸

#### 2. í™˜ê²½ ë³€ìˆ˜ ë° ì„¤ì • ê°œì„ 
- [ ] í™˜ê²½ë³„ ì„¤ì • íŒŒì¼ ë¶„ë¦¬ (dev, prod)
- [ ] ë” ìƒì„¸í•œ í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
- [ ] Docker ì»¨í…Œì´ë„ˆ ì„¤ì •
- [ ] Health check ì—”ë“œí¬ì¸íŠ¸ ê°œì„  (DB ì—°ê²° ìƒíƒœ í¬í•¨)

### ğŸ›  ê¸°ëŠ¥ ê°œì„  ë° í™•ì¥

#### 3. íŒŒì¼ ì—…ë¡œë“œ ê°œì„ 
- [ ] ì—…ë¡œë“œ ì§„í–‰ë¥  ì§€ì› (WebSocket ë˜ëŠ” Server-Sent Events)
- [ ] íŒŒì¼ ì—…ë¡œë“œ ì¬ê°œ ê¸°ëŠ¥ (chunked upload)
- [ ] ëŒ€ìš©ëŸ‰ íŒŒì¼ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
- [ ] ì—…ë¡œë“œ í ê´€ë¦¬ (ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬)

#### 4. ë°°ì¹˜ ì—…ë¡œë“œ ì™„ì„±
- [ ] ë°°ì¹˜ ì—…ë¡œë“œ ë¡œì§ ì™„ì „ êµ¬í˜„
- [ ] ë°°ì¹˜ ì‘ì—… ìƒíƒœ ì¶”ì 
- [ ] ì‹¤íŒ¨í•œ íŒŒì¼ ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜

#### 5. íŒŒì¼ ê²€ì¦ ê°•í™”
- [ ] íŒŒì¼ ë‚´ìš© ê¸°ë°˜ AI ë„êµ¬ ìë™ ê°ì§€ ê°œì„ 
- [ ] ì„¸ì…˜ íŒŒì¼ êµ¬ì¡° ê²€ì¦ (JSONL í˜•ì‹ ë“±)
- [ ] ë°”ì´ëŸ¬ìŠ¤ ìŠ¤ìº” í†µí•© (ì„ íƒì‚¬í•­)

#### 6. ìºì‹± ì‹œìŠ¤í…œ
- [ ] Redis ìºì‹± ë ˆì´ì–´ ì¶”ê°€
- [ ] íŒŒì¼ ë©”íƒ€ë°ì´í„° ìºì‹±
- [ ] í†µê³„ ë°ì´í„° ìºì‹±
- [ ] CDN í†µí•© (íŒŒì¼ ë‹¤ìš´ë¡œë“œ ìµœì í™”)

### ğŸ”’ ë³´ì•ˆ ë° ê¶Œí•œ

#### 7. ë³´ì•ˆ ê°•í™”
- [ ] API í‚¤ ê¸°ë°˜ ì¸ì¦ ì¶”ê°€ (ì„œë²„ ê°„ í†µì‹ ìš©)
- [ ] ì„¸ì…˜ë³„ ì„ì‹œ í† í° ìƒì„±
- [ ] íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë³´ì•ˆ ë§í¬ (expire URL)
- [ ] Audit log ì‹œìŠ¤í…œ

#### 8. ê¶Œí•œ ê´€ë¦¬ ê°œì„ 
- [ ] íŒ€ ì—­í• ë³„ ì„¸ë¶€ ê¶Œí•œ ì œì–´
- [ ] íŒŒì¼ ê³µìœ  ê¶Œí•œ ê´€ë¦¬
- [ ] ê´€ë¦¬ì ì „ìš© API ë¶„ë¦¬

### ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

#### 9. ë¡œê¹… ì‹œìŠ¤í…œ ê°œì„ 
- [ ] êµ¬ì¡°í™”ëœ ë¡œê¹… (JSON í˜•íƒœ)
- [ ] ë¡œê·¸ ë ˆë²¨ë³„ í•„í„°ë§
- [ ] ì™¸ë¶€ ë¡œê·¸ ìˆ˜ì§‘ ì‹œìŠ¤í…œ ì—°ë™ (ELK Stack)
- [ ] ì—ëŸ¬ íŠ¸ë˜í‚¹ (Sentry ë“±)

#### 10. ë©”íŠ¸ë¦­ìŠ¤ ë° ëª¨ë‹ˆí„°ë§
- [ ] Prometheus ë©”íŠ¸ë¦­ìŠ¤ ìˆ˜ì§‘
- [ ] API ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- [ ] íŒŒì¼ ì—…ë¡œë“œ í†µê³„ ìˆ˜ì§‘
- [ ] ì•Œë¦¼ ì‹œìŠ¤í…œ (Slack, Discord ë“±)

### ğŸ§ª í…ŒìŠ¤íŠ¸ ë° í’ˆì§ˆ

#### 11. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Vitest)
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ (API ì—”ë“œí¬ì¸íŠ¸)
- [ ] íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (ë¶€í•˜ í…ŒìŠ¤íŠ¸)

#### 12. ì½”ë“œ í’ˆì§ˆ ê°œì„ 
- [ ] ESLint ì„¤ì • ë° ê·œì¹™ ì¶”ê°€
- [ ] Prettier ì½”ë“œ í¬ë§·íŒ…
- [ ] Pre-commit hooks ì„¤ì •
- [ ] íƒ€ì… ì»¤ë²„ë¦¬ì§€ ê°œì„ 

### ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

#### 13. ì„±ëŠ¥ íŠœë‹
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”
- [ ] íŒŒì¼ ì—…ë¡œë“œ ì„±ëŠ¥ ê°œì„ 
- [ ] ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
- [ ] ì‘ë‹µ ì‹œê°„ ê°œì„ 

#### 14. í™•ì¥ì„± ì¤€ë¹„
- [ ] ë¡œë“œ ë°¸ëŸ°ì„œ ì§€ì›
- [ ] ì„œë²„ í´ëŸ¬ìŠ¤í„°ë§
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ ìµœì í™”
- [ ] ìˆ˜í‰ í™•ì¥ ëŒ€ë¹„

### ğŸ“‹ API ë¬¸ì„œ ë° ë„êµ¬

#### 15. API ë¬¸ì„œí™”
- [x] ì»¤ìŠ¤í…€ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ êµ¬í˜„ (http://localhost:3001/test/)
- [x] íŒŒì¼ ì—…ë¡œë“œ ìµœì í™” í…ŒìŠ¤íŠ¸ UI (ë“œë˜ê·¸ì•¤ë“œë¡­, JWT ê´€ë¦¬)
- [x] Postman ì»¬ë ‰ì…˜ ìƒì„±
- [ ] OpenAPI (Swagger) ìŠ¤í™ ì‘ì„± (ì„ íƒì‚¬í•­)
- [ ] SDK ìƒì„± (í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬)

#### 16. ê°œë°œ ë„êµ¬
- [x] ì»¤ìŠ¤í…€ API í…ŒìŠ¤íŠ¸ í˜ì´ì§€ (/test/)
- [x] Postman í…ŒìŠ¤íŠ¸ ì»¬ë ‰ì…˜
- [ ] ê°œë°œìš© íŒŒì¼ ì—…ë¡œë“œ CLI ë„êµ¬
- [ ] ê°œë°œ í™˜ê²½ Docker Compose

### ğŸš€ ë°°í¬ ë° ìš´ì˜

#### 17. CI/CD íŒŒì´í”„ë¼ì¸
- [ ] GitHub Actions ì„¤ì •
- [ ] ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- [ ] ìë™ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
- [ ] í™˜ê²½ë³„ ë°°í¬ ê´€ë¦¬

#### 18. ìš´ì˜ ë„êµ¬
- [ ] ì„œë²„ ìƒíƒœ ëŒ€ì‹œë³´ë“œ
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ìë™í™”
- [ ] ë¡œê·¸ ë¡œí…Œì´ì…˜ ì„¤ì •
- [ ] ë³´ì•ˆ íŒ¨ì¹˜ ìë™í™”

## Supabase ì„¤ì • (Dashboard ë°©ì‹)

### 1. í”„ë¡œì íŠ¸ ìƒì„±
1. [Supabase Dashboard](https://supabase.com/dashboard) ì ‘ì†
2. ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± (Organization: vibereview)
3. í”„ë¡œì íŠ¸ëª…: `vibereview-api`
4. Database ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ë° ì €ì¥

### 2. í™˜ê²½ ë³€ìˆ˜ í™•ì¸
í”„ë¡œì íŠ¸ ìƒì„± í›„ Settings > APIì—ì„œ ë‹¤ìŒ ì •ë³´ í™•ì¸:
- `SUPABASE_URL`: Project URL
- `SUPABASE_ANON_KEY`: anon/public key  
- `SUPABASE_SERVICE_KEY`: service_role key (ì„œë²„ìš©)

### 3. í•„ìˆ˜ ì„¤ì • ì‘ì—…
- **ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ**: í…Œì´ë¸” ë° RLS ì •ì±… ìƒì„±
- **Storage ë²„í‚·**: `session-files` ë²„í‚· ìƒì„± ë° ê¶Œí•œ ì„¤ì •
- **Authentication**: ì‚¬ìš©ì ê°€ì…/ë¡œê·¸ì¸ ì„¤ì •
- **íƒ€ì… ìƒì„±**: SQL Editorì—ì„œ ìŠ¤í‚¤ë§ˆ í™•ì¸ í›„ TypeScript íƒ€ì… ìƒì„±

## ê°œë°œ ëª…ë ¹ì–´

```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰
pnpm dev

# íƒ€ì… ì²´í¬
pnpm type-check

# ë¹Œë“œ
pnpm build

# í”„ë¡œë•ì…˜ ì‹¤í–‰
pnpm start

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
pnpm test

# í…ŒìŠ¤íŠ¸ UI
pnpm test:ui
```

## í™˜ê²½ ë³€ìˆ˜

í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ë“¤:

```bash
# Supabase
SUPABASE_URL=http://localhost:54321
SUPABASE_ANON_KEY=your_anon_key_here
SUPABASE_SERVICE_KEY=your_service_key_here

# ì„œë²„
PORT=3001
HOST=localhost
NODE_ENV=development

# ì—…ë¡œë“œ ì„¤ì •
MAX_FILE_SIZE=52428800
ALLOWED_MIME_TYPES=application/json,application/jsonl,text/plain,text/csv

# ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW=900000
```

## API ì—”ë“œí¬ì¸íŠ¸

### ì—…ë¡œë“œ API
- `POST /api/upload/file` - ë‹¨ì¼ íŒŒì¼ ì—…ë¡œë“œ
- `POST /api/upload/batch` - ë°°ì¹˜ íŒŒì¼ ì—…ë¡œë“œ
- `GET /api/upload/status/:fileId` - ì—…ë¡œë“œ ìƒíƒœ í™•ì¸

### ë©”íƒ€ë°ì´í„° API
- `GET /api/metadata/files` - íŒŒì¼ ëª©ë¡ ì¡°íšŒ
- `GET /api/metadata/files/:fileId` - íŒŒì¼ ìƒì„¸ ì •ë³´
- `DELETE /api/metadata/files/:fileId` - íŒŒì¼ ì‚­ì œ
- `GET /api/metadata/stats` - íŒ€ í†µê³„
- `GET /api/metadata/files/:fileId/download` - íŒŒì¼ ë‹¤ìš´ë¡œë“œ

### í—¬ìŠ¤ì²´í¬
- `GET /health` - ì„œë²„ ìƒíƒœ í™•ì¸

## íŒŒì¼ êµ¬ì¡°

```
src/
â”œâ”€â”€ index.ts                 # ë©”ì¸ ì„œë²„ íŒŒì¼
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ env.ts              # í™˜ê²½ë³€ìˆ˜ íƒ€ì…
â”‚   â”œâ”€â”€ api.ts              # API íƒ€ì… ì •ì˜
â”‚   â””â”€â”€ database.ts         # DB íƒ€ì… (Supabase ìƒì„±)
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ supabase.ts         # Supabase í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ file-validation.ts  # íŒŒì¼ ê²€ì¦ ë¡œì§
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.ts             # ì¸ì¦ ë¯¸ë“¤ì›¨ì–´
â””â”€â”€ routes/
    â”œâ”€â”€ upload/
    â”‚   â””â”€â”€ index.ts        # ì—…ë¡œë“œ ë¼ìš°íŠ¸
    â””â”€â”€ metadata/
        â””â”€â”€ index.ts        # ë©”íƒ€ë°ì´í„° ë¼ìš°íŠ¸
```

## ìš°ì„ ìˆœìœ„

### High Priority (ì¦‰ì‹œ í•„ìš”)
1. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±** - ì•ˆì •ì„± í™•ë³´ (Vitest)
2. **ë°°ì¹˜ ì—…ë¡œë“œ ì™„ì„±** - í˜„ì¬ êµ¬í˜„ ë¯¸ì™„ì„±
3. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ê°œì„ ** - í”„ë¡œë•ì…˜ ë°°í¬ ì¤€ë¹„
4. **ESLint/Prettier ì„¤ì •** - ì½”ë“œ í’ˆì§ˆ ë„êµ¬

### Medium Priority (ë‹¨ê¸°)
5. **íŒŒì¼ ê²€ì¦ ê°•í™”** - ë°ì´í„° í’ˆì§ˆ
6. **ìºì‹± ì‹œìŠ¤í…œ** - ì„±ëŠ¥ ê°œì„ 
7. **ë¡œê¹… ê°œì„ ** - ë””ë²„ê¹… íš¨ìœ¨ì„±
8. **Docker ì»¨í…Œì´ë„ˆ ì„¤ì •** - ë°°í¬ í™˜ê²½

### Low Priority (ì¥ê¸°)
9. **ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ** - ìš´ì˜ ì•ˆì •ì„±
10. **ì„±ëŠ¥ ìµœì í™”** - í™•ì¥ì„± ëŒ€ë¹„
11. **CI/CD íŒŒì´í”„ë¼ì¸** - ìë™í™”
12. **ë³´ì•ˆ ê°•í™”** - ì—”í„°í”„ë¼ì´ì¦ˆ ëŒ€ë¹„

## ê´€ë ¨ ë¬¸ì„œ

- [ë©”ì¸ í”„ë¡œì íŠ¸ ê³„íšì„œ](../PROJECT_PLAN.md)
- [ì „ì²´ ì•„í‚¤í…ì²˜ ë¬¸ì„œ](../CLAUDE.md)
- [Workers ë¬¸ì„œ](../vibereview-workers/CLAUDE.md)
- [SQL ìŠ¤í‚¤ë§ˆ ë¬¸ì„œ](../vibereview-sql/CLAUDE.md)